{% load static %}
<html lang="ko" data-layout="vertical" data-sidebar="dark" data-sidebar-size="sm-hover" data-sidebar-image="none" data-preloader="disable" data-topbar="light" data-layout-style="default" data-layout-mode="light" data-layout-width="fluid" data-layout-position="fixed">

<head>

    <meta charset="utf-8" />
    <title>{% block title %}{% endblock %} | WAVE&middot;ML</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta content="Premium Multipurpose Admin & Dashboard Template" name="description" />
    <meta content="Themesbrand" name="author" />
    <!-- App favicon -->
    <link rel="shortcut icon" href="{% static 'images/favicon.ico' %}">

    <!-- Plugins css -->
    <link href="{% static 'libs/dropzone/dropzone.css' %}" rel="stylesheet" type="text/css" />
    <!-- swiper css -->
    <link rel="stylesheet" href="{% static 'libs/swiper/swiper-bundle.min.css' %}">
    <!-- Sweet Alert css-->
    <link href="{% static 'libs/sweetalert2/sweetalert2.min.css' %}" rel="stylesheet" type="text/css" />
    <!-- Layout config Js -->
    <script src="{% static 'js/layout.js' %}"></script>
    <!-- JQuery -->
    <script src="{% static 'js/jquery-3.6.3.min.js' %}"></script>
    <!-- Bootstrap Css -->
    <link href="{% static 'css/bootstrap.min.css' %}" rel="stylesheet" type="text/css" />
    <!-- Icons Css -->
    <link href="{% static 'css/icons.min.css' %}" rel="stylesheet" type="text/css" />
    <!-- App Css-->
    <link href="{% static 'css/app.min.css' %}" rel="stylesheet" type="text/css" />
    <!-- custom Css-->
    <link href="{% static 'css/custom.min.css' %}" rel="stylesheet" type="text/css" />
</head>

<body>
    <!-- Begin page -->
    <div id="layout-wrapper">
        <header id="page-topbar">
            <div class="layout-width">
                <div class="navbar-header">
                    <!-- start page title -->
                    <div class="col-12">
                        <div class="d-flex align-items-center flex-wrap">
                            <button type="button" class="btn btn-sm px-3 fs-16 header-item vertical-menu-btn topnav-hamburger" id="topnav-hamburger-icon">
                                <span class="hamburger-icon">
                                    <span></span>
                                    <span></span>
                                    <span></span>
                                </span>
                            </button>

                            <h3 class="mb-0">{% block middle-title %}{% endblock %}</h3>
                        </div>
                    </div>
                    <!-- end page title -->
                </div>
            </div>
        </header>

        {% include 'navigator.html' %}

        <!-- Vertical Overlay-->
        <div class="vertical-overlay"></div>

        <!-- ============================================================== -->
        <!-- Start right Content here -->
        <!-- ============================================================== -->
        <div class="main-content">
            {% block content %}
            {% endblock %}

            {% include 'footer.html' %}
        </div>
        <!-- end main content-->

        <!-- Modals -->
        <form method="post" enctype="multipart/form-data" id="project_registration_form">
            {% csrf_token %}
            <div id="myModal" class="modal fade" tabindex="-1" aria-labelledby="myModalLabel" style="display: none;" aria-modal="true" role="dialog">
                <div class="modal-dialog modal-dialog-centered modal-lg">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title text-white" id="myModalLabel">프로젝트 등록</h5>
                            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <div class="text-center mb-4 mt-n3 pt-2">
                                <div class="position-relative d-inline-block">
                                    <div class="position-absolute bottom-0 end-0">
                                        <label for="companylogo-image-input" class="mb-0" data-bs-toggle="tooltip" data-bs-placement="right" title="Select Image">
                                            <div class="avatar-xs cursor-pointer">
                                                <div class="avatar-title bg-light border rounded-circle text-muted">
                                                    <i class="ri-image-fill"></i>
                                                </div>
                                            </div>
                                        </label>
                                        <input class="form-control d-none" name="project_image" value="" id="companylogo-image-input" type="file" accept="image/png, image/gif, image/jpeg" onchange="check_img(this)">
                                    </div>
                                    <div class="avatar-lg p-1">
                                        <div class="avatar-title bg-light rounded-circle" id="img-none">
                                            <div class="bg-avatarbg avatar-md rounded-circle d-flex justify-content-center align-items-center">
                                                <i class='bx bx-customize' style="font-size: 35px;"></i>
                                            </div>
                                        </div>
                                        <div id="img-exists" class="avatar-title bg-light rounded-circle" style="display: none;">
                                            <img src="" class="img-thumbnail rounded-circle bg-light w-100 h-100" id="img-spot">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="row g-3">
                                <div class="col-lg-6">
                                    <div>
                                        <label for="select_for_project_type" class="form-label">대분류</label>
                                        <select class="form-select" id="select_for_project_type" name="project_type" required>
                                            <option value="누리어시스템" selected>누리어시스템</option>
                                            <option value="NH농협은행">NH농협은행</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-lg-6">
                                    <div>
                                        <label for="select_for_project_sub_type" class="form-label">소분류</label>
                                        <select class="form-select" id="select_for_project_sub_type" name="project_sub_type" required>
                                            <option value="인터넷 뱅킹" selected>인터넷 뱅킹</option>
                                            <option value="스마트 뱅킹">스마트 뱅킹</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="col-lg-12">
                                    <label for="project_name" class="form-label">프로젝트명</label>
                                    <input type="text" id="project_name" class="form-control" name="project_name" placeholder="프로젝트명을 입력하세요" required />
                                </div>

                                <div class="col-lg-6">
                                    <div>
                                        <label for="registrant_name" class="form-label">등록자</label>
                                        <input type="text" id="registrant_name" name="registrant_name" class="form-control" required readonly />
                                    </div>
                                </div>
                                <!--<div class="col-lg-4">
                                    <div>
                                        <label for="" class="form-label">권한</label>
                                        <select class="form-select" id="" required>
                                            <option selected="">총괄</option>
                                            <option value="">Part Time</option>
                                            <option value="">Freelance</option>
                                            <option value="">Intership</option>
                                        </select>
                                    </div>
                                </div>-->
                                <div class="col-lg-6">
                                    <div>
                                        <label for="registration_date" class="form-label">등록일시</label>
                                        <input type="text" id="registration_date" class="form-control flatpickr-input" data-provider="flatpickr" data-date-format="Y.m.d" data-default-date="today" placeholder="" readonly>
                                    </div>
                                </div>

                                <div class="col-12">
                                    <div>
                                        <label for="project_explanation" class="form-label">프로젝트 내용</label>
                                        <textarea class="form-control" id="project_explanation" name="project_explanation" placeholder="프로젝트 설명을 입력하세요" rows="3" spellcheck="false" style="resize: none;"></textarea>
                                    </div>
                                </div>
                            </div>

                            <div>
                                <p class="mt-3 mb-2">파일등록</p>

                                <div class="dropzone" style="min-height: 100px;">
                                    <div class="fallback">
                                        <input name="file" type="file" multiple="multiple">
                                    </div>
                                    <div class="dz-message needsclick">
                                        <div class="mb-3">
                                            <i class="display-5 text-muted bx bx-cloud-upload"></i>
                                        </div>
                                        <h5 class="fs-6">버튼을 클릭하거나 파일을 마우스로 끌어 오세요.</h5>
                                    </div>
                                </div>

                                <ul class="list-unstyled mb-0" id="dropzone-preview">
                                    <li class="mt-2" id="dropzone-preview-list">
                                        <!-- This is used as the file preview template -->
                                        <div class="border rounded">
                                            <div class="d-flex align-items-center p-2">
                                                <div class="flex-shrink-0 me-3">
                                                    <div class="avatar-sm bg-light text-muted rounded d-flex align-items-center justify-content-center fs-3">
                                                        <i class="ri-attachment-2"></i>
                                                        <!-- <img src="#" alt="Project-Image" data-dz-thumbnail class="img-fluid rounded d-block" /> -->
                                                    </div>
                                                </div>
                                                <div class="flex-grow-1">
                                                    <div class="pt-1">
                                                        <h5 class="fs-14 mb-1" data-dz-name>&nbsp;</h5>
                                                        <p class="fs-13 text-muted mb-0" data-dz-size></p>
                                                        <strong class="error text-danger" data-dz-errormessage></strong>
                                                    </div>
                                                </div>
                                                <div class="flex-shrink-0 ms-3">
                                                    <button data-dz-remove class="btn btn-sm btn-light text-muted lh-1 p-1"><i class='bx bx-x fs-4'></i></button>
                                                </div>
                                            </div>
                                        </div>
                                    </li>
                                </ul>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" id="btn_for_project_cancel" class="btn btn-light" data-bs-dismiss="modal">취소</button>
                            <button type="button" id="btn_for_project_registration" class="btn btn-primary">등록</button>
                        </div>
                    </div><!-- /.modal-content -->
                </div><!-- /.modal-dialog -->
            </div><!-- /.modal -->
            <input type="hidden" id="project_id_for_modify" name="project_id_for_modify" value="">
            <input type="hidden" id="project_modify_position_check" name="project_modify_position_check" value="">
            <input type="hidden" id="project_modify_img_check" name="project_modify_img_check" value="">
        </form>
    </div>
    <!-- END layout-wrapper -->

    <!-- JAVASCRIPT -->
    <script src="{% static 'libs/bootstrap/js/bootstrap.bundle.min.js' %}"></script>
    <script src="{% static 'libs/simplebar/simplebar.min.js' %}"></script>
    <script src="{% static 'libs/node-waves/waves.min.js' %}"></script>
    <script src="{% static 'libs/feather-icons/feather.min.js' %}"></script>
    <script src="{% static 'js/pages/plugins/lord-icon-2.1.0.js' %}"></script>
    <script src="{% static 'js/plugins.js' %}"></script>

    <!-- dropzone js -->
    <script src="{% static 'libs/dropzone/dropzone-min.js' %}"></script>
    <!-- project-create init -->
    <script src="{% static 'js/pages/project-create.init.js' %}"></script>
    <!-- App js -->
    <script src="{% static 'js/app.js' %}"></script>
    <!-- Sweet Alerts js -->
    <script src="{% static 'libs/sweetalert2/sweetalert2.min.js' %}"></script>

</body>
<script type="text/javascript">
    $(function() {
        <!-- 유저 정보 등록 -->
        $('#registrant_name').val('{{ user_name }}');

        <!-- 프로젝트 등록 -->
        $("#btn_for_project_registration").on("click", function(e) {
            e.preventDefault();
            project_registration();
        });

        <!-- 모달 종료 시 이벤트 -->
        $("#myModal").on("hidden.bs.modal", function(e){
            <!-- 작성된 기존 폼 데이터 초기화 -->
            $("#project_registration_form")[0].reset();

            <!-- 등록한 파일 초기화 -->
            var file_size = $("#dropzone-preview li").length;
            if(file_size > 0) {
                $("#dropzone-preview").html("");
            }

            <!-- 등록한 이미지 초기화 -->
            $("#img-none").show();
            $("#img-spot").src = "";
            $("#img-exists").hide();

            <!-- 편집으로 모달 접근 -->
            if(sessionStorage.getItem('modify')) {
                sessionStorage.removeItem('modify');
            }
        });

        <!-- 모달 시작 시 이벤트 -->
        $("#myModal").on("show.bs.modal", function(e){
            <!-- 유저 정보 지정 -->
            $('#registrant_name').val('{{ user_name }}');

            <!-- 등록자, 등록일시 기본값 지정 -->
            $("#registration_name").val($('#registrant_name').val());
            var today = new Date();
            var year = today.getFullYear();
            var month = ('0' + (today.getMonth() + 1)).slice(-2);
            var day = ('0' + today.getDate()).slice(-2);
            var dateString = year + '.' + month  + '.' + day;
            $("#registration_date").val(dateString);

            <!-- 등록자, 등록일시 수정 불가 지정 -->
            $("#registration_date").attr("disabled", true);
            $("#registrant_name").attr("disabled", true);
        });
    });

    <!-- 프로젝트 등록, 편집 함수 -->
    function project_registration() {
        var form_data = new FormData($("#project_registration_form")[0]);

        <!--대분류, 소분류, 프로젝트명, 등록자, 파일등록 유효성 검사-->
        var project_type = form_data.get('project_type');
        var project_sub_type = form_data.get('project_sub_type');
        var project_name = form_data.get('project_name');
        var registrant_name = form_data.get('registrant_name');
        var project_file = form_data.get('project_file');

<!--        if(typeof project_type == "undefined" || project_type == null || project_type == "") {-->
<!--            Swal.fire({-->
<!--                title:'대분류를 확인해주세요',-->
<!--                icon: 'warning',-->
<!--                confirmButtonClass: 'btn btn-primary w-xs mt-2',-->
<!--                buttonsStyling: false-->
<!--            })-->
<!--            return false;-->
<!--        } else if(typeof project_sub_type == "undefined" || project_sub_type == null || project_sub_type == "") {-->
<!--            Swal.fire({-->
<!--                title:'소분류를 확인해주세요',-->
<!--                icon: 'warning',-->
<!--                confirmButtonClass: 'btn btn-primary w-xs mt-2',-->
<!--                buttonsStyling: false-->
<!--            })-->
<!--            return false;-->
<!--        } else if(typeof project_name == "undefined" || project_name == null || project_name == "") {-->
<!--            Swal.fire({-->
<!--                title:'프로젝트명을 확인해주세요',-->
<!--                icon: 'warning',-->
<!--                confirmButtonClass: 'btn btn-primary w-xs mt-2',-->
<!--                buttonsStyling: false-->
<!--            })-->
<!--            return false;-->
<!--        } else if(typeof registrant_name == "undefined" || registrant_name == null || registrant_name == "") {-->
<!--            Swal.fire({-->
<!--                title:'등록자를 확인해주세요',-->
<!--                icon: 'warning',-->
<!--                confirmButtonClass: 'btn btn-primary w-xs mt-2',-->
<!--                buttonsStyling: false-->
<!--            })-->
<!--            return false;-->
<!--        } else if(typeof project_file == "undefined" || project_file == null || project_file == "") {-->
<!--            Swal.fire({-->
<!--                title:'파일등록을 확인해주세요',-->
<!--                icon: 'warning',-->
<!--                confirmButtonClass: 'btn btn-primary w-xs mt-2',-->
<!--                buttonsStyling: false-->
<!--            })-->
<!--            return false;-->
<!--        }-->
        <!-- 등록, 편집 url 판단 -->
        var url = "";
        if(sessionStorage.getItem('modify')) {
            url = '/project/modify/';
            if(typeof $("#img-spot").attr('src') == "undefined" || $("#img-spot").attr('src') == null || $("#img-spot").attr('src') == "") {
                $("#project_modify_img_check").val("");
            }
            form_data.append('project_modify_img_check', $("#project_modify_img_check").val());
        } else {
            url = '/project/registration/';
        }

        $.ajax({
            type: 'POST',
            url: url,
            data: form_data,
            cache: false,
            contentType: false,
            processData: false,
            success: function(data) {
                if($("#project_modify_position_check").val() == 'detail') {
                    location.reload();
                } else {
                    $("#btn_for_project_cancel").trigger("click");
                    $("#project-list-row-container").html("");
                    $("#project-list-row-container").html(data);
                }
            },
            error: function(data) {
                console.log("project_registration error");
            }
        });
    }

    <!-- 이미지 등록 미리보기 -->
    function check_img(input) {
        if(input.files && input.files[0]) {
            var reader = new FileReader();
            reader.onload = function(e) {
                $("#img-none").hide();
                $("#img-exists").show();
                $("#img-spot").attr('src', e.target.result);
            };
            reader.readAsDataURL(input.files[0]);
        } else {
            $("#img-spot").attr('src', "");
            $("#img-exists").hide();
            $("#img-none").show();
        }
    }
    </script>
</html>